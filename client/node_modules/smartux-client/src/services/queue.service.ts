import { Injectable } from '@angular/core';

@Injectable()
export class QueueService {
  private queue = [];

  constructor() {}

  push(worker: () => Promise<any>): Promise<any> {
    return new Promise((resolve, reject) => {
      this.queue.push({worker: worker, resolve: resolve, reject: reject});
      if (this.queue.length === 1) {
        this.next();
      }
    });
  }

  // ----------------------------------------------------------------------------------------------

  private process() {
    this.queue.shift();
    if (this.queue.length > 0) {
      this.next();
    }
  }

  private async next() {
    let task = this.queue[0];
    await task.worker().then(task.resolve, task.reject);
    this.process();
  }

}
